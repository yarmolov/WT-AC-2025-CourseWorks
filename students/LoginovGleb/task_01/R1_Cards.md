# Вариант 40 — Карточки (обязательные поля и валидации)

## 1. Форма аутентификации

- email: string, формат email, не пустое → ошибка: «Введите корректный email.»
- password: string, минимум 6 символов, не пустое → ошибка: «Пароль должен содержать минимум 6 символов.»

## 2. Форма регистрации

- username: string, только буквы и цифры, 3-50 символов → ошибка: «Имя пользователя должно быть от 3 до 50 символов (буквы и цифры).»
- email: string, формат email, уникальный → ошибка: «Email уже используется.»
- password: string, минимум 6 символов → ошибка: «Пароль должен содержать минимум 6 символов.»
- confirmPassword: string, должен совпадать с password → ошибка: «Пароли не совпадают.»

## 3. Карточка формы заявки (Form)

- id: UUID, автогенерируется
- name: string, не пустое, макс 200 символов → ошибка: «Введите название формы.»
- description: string, опционально, макс 2000 символов
- fields: JSON, массив полей формы, не пустой → ошибка: «Форма должна содержать хотя бы одно поле.»
- is_active: boolean, default: true
- created_by: reference -> User.id, автозаполнение

## 4. Карточка статуса (Status)

- id: UUID, автогенерируется
- name: string, уникальное, не пустое → ошибка: «Введите название статуса.»
- description: string, опционально
- color: string, формат hex (#RRGGBB), default: #808080 → ошибка: «Неверный формат цвета.»
- order: integer, не отрицательное → ошибка: «Порядок должен быть неотрицательным числом.»
- is_final: boolean, default: false

## 5. Карточка заявки (Application)

- id: UUID, автогенерируется
- form_id: reference -> Form.id, не пустое → ошибка: «Выберите форму заявки.»
- user_id: reference -> User.id, автозаполнение
- status_id: reference -> Status.id, default: draft
- data: JSON, валидируется по схеме формы → ошибка: «Заполните все обязательные поля формы.»
- comment: string, опционально, макс 5000 символов
- created_at: datetime, автозаполнение
- submitted_at: datetime, заполняется при отправке

## 6. Карточка вложения (Attachment)

- id: UUID, автогенерируется
- application_id: reference -> Application.id, не пустое → ошибка: «Выберите заявку.»
- filename: string, не пустое, безопасное имя (без path traversal) → ошибка: «Имя файла не может быть пустым.»
- file_path: string, автозаполнение (генерируется сервером, не принимается от клиента)
- file_size: integer, не больше 10 МБ → ошибка: «Размер файла не должен превышать 10 МБ.»
- mime_type: string, допустимые типы: pdf, doc, docx, jpg, png → ошибка: «Недопустимый тип файла.»
- uploaded_by: reference -> User.id, автозаполнение
- uploaded_at: datetime, автозаполнение

**Ограничения на уровне заявки:**

- Максимум 10 файлов на одну заявку → ошибка: «Превышен лимит вложений (максимум 10 файлов).»
- Общий размер вложений на заявку: не более 50 МБ → ошибка: «Превышен общий размер вложений (максимум 50 МБ).»
- Загрузка возможна только для заявок в статусе `draft`

**Безопасность:**

- Доступ к скачиванию: владелец заявки, Moderator или Admin
- Удаление: владелец (только для draft) или Admin

## 7. Карточка пользователя (User)

- id: UUID, автогенерируется
- username: string, уникальное, не пустое → ошибка: «Введите имя пользователя.»
- email: string, уникальное, формат email → ошибка: «Введите корректный email.»
- password_hash: string, автогенерируется из пароля
- role: enum [admin, moderator, user], default: user → ошибка: «Выберите роль.»
- created_at: datetime, автозаполнение

---

## Пользовательские истории (User Stories)

## US-01: Регистрация пользователя

**Как** гость  
**Я хочу** зарегистрироваться в системе  
**Чтобы** получить доступ к созданию заявок

**Критерии приёмки (AC):**

- При успешной регистрации пользователь получает роль `user`
- Email должен быть уникальным
- Пароль хранится в зашифрованном виде
- После регистрации пользователь перенаправляется на страницу входа

---

## US-02: Авторизация пользователя

**Как** зарегистрированный пользователь  
**Я хочу** войти в систему  
**Чтобы** получить доступ к личному кабинету

**Критерии приёмки (AC):**

- При успешном входе выдаётся JWT токен
- Неверные учётные данные возвращают ошибку
- После входа пользователь перенаправляется на дашборд

---

## US-03: Просмотр списка форм

**Как** пользователь  
**Я хочу** видеть список доступных форм заявок  
**Чтобы** выбрать нужную для подачи заявки

**Критерии приёмки (AC):**

- Отображаются только активные формы (is_active = true)
- Для каждой формы показывается название и описание
- Есть возможность перейти к созданию заявки по выбранной форме

---

## US-04: Создание заявки

**Как** пользователь  
**Я хочу** создать новую заявку по выбранной форме  
**Чтобы** подать своё обращение

**Критерии приёмки (AC):**

- Заявка создаётся в статусе `draft`
- Поля валидируются согласно схеме формы
- Можно сохранить черновик и вернуться к редактированию позже
- Отображается сообщение об успешном создании

---

## US-05: Загрузка вложений

**Как** пользователь  
**Я хочу** прикрепить файлы к своей заявке  
**Чтобы** предоставить необходимые документы

**Критерии приёмки (AC):**

- Поддерживаются форматы: PDF, DOC, DOCX, JPG, PNG
- Максимальный размер файла: 10 МБ
- Можно загрузить несколько файлов
- Файлы отображаются в списке вложений заявки

---

## US-06: Отправка заявки на рассмотрение

**Как** пользователь  
**Я хочу** отправить заполненную заявку на рассмотрение  
**Чтобы** она была рассмотрена модератором

**Критерии приёмки (AC):**

- Статус заявки меняется с `draft` на `pending`
- Заполняется поле `submitted_at`
- После отправки редактирование заявки недоступно
- В истории создаётся запись о смене статуса

---

## US-07: Отслеживание статуса заявки

**Как** пользователь  
**Я хочу** видеть текущий статус своих заявок  
**Чтобы** отслеживать прогресс рассмотрения

**Критерии приёмки (AC):**

- На дашборде отображается список заявок с текущим статусом
- Статус визуально выделен цветом
- Можно просмотреть историю изменений статуса
- Есть фильтрация по статусам

---

## US-08: Рассмотрение заявки модератором

**Как** модератор  
**Я хочу** просматривать и обрабатывать поступившие заявки  
**Чтобы** принять решение по каждой из них

**Критерии приёмки (AC):**

- Модератор видит все заявки в статусе `pending`
- Можно просмотреть детали заявки и вложения
- Можно изменить статус (одобрить/отклонить/запросить доработку)
- При изменении статуса можно добавить комментарий

---

## US-09: Создание формы администратором

**Как** администратор  
**Я хочу** создавать новые формы заявок  
**Чтобы** пользователи могли подавать разные типы заявок

**Критерии приёмки (AC):**

- Можно задать название и описание формы
- Можно настроить список полей с типами и валидацией
- Форму можно сделать активной или неактивной
- Созданная форма сохраняется в базе данных

---

## US-10: Управление пользователями

**Как** администратор  
**Я хочу** управлять пользователями системы  
**Чтобы** назначать роли и контролировать доступ

**Критерии приёмки (AC):**

- Отображается список всех пользователей
- Можно изменить роль пользователя
- Можно деактивировать/удалить пользователя
- Изменения сохраняются в базе данных
