# Вариант 09 — Матрица прав (операция × роль)

## Операции × Роли

Роли: **Администратор**, **Пользователь**, **Гость**  
Операции: CRUD постов, CRUD комментариев, Лайки, Теги, Пользователи, Черновики

| Операция                        | Администратор | Пользователь       | Гость |
|---------------------------------|---------------|--------------------|-------|
| **Просмотр постов (GET /posts)**| ✓             | ✓                  | ✓     |
| **Создание поста (POST /posts)**| ✓             | ✓ (свои)           | ✗     |
| **Редактирование поста (PUT)**  | ✓ (любые)     | ✓ (свои)           | ✗     |
| **Удаление поста (DELETE)**     | ✓ (любые)     | ✓ (свои)           | ✗     |
| **Просмотр комментариев**       | ✓             | ✓                  | ✓     |
| **Создание комментария**        | ✓             | ✓                  | ✗     |
| **Лайк поста**                  | ✓             | ✓                  | ✗     |
| **Просмотр черновиков**         | ✓ (все)       | ✓ (свои)           | ✗     |
| **CRUD тегов**                  | ✓             | ✗                  | ✗     |
| **Управление пользователями**   | ✓             | ✗                  | ✗     |

## Примечания к правам доступа

- **Scope ограничение**: Пользователь видит только свои черновики и может редактировать/удалять только свои посты
- **Анонимный доступ**: Гости могут читать опубликованные посты и комментарии, но не взаимодействовать
- **Middleware защита**: Все защищённые операции используют `authMiddleware` с проверкой `req.user.id/role`
- **Токен JWT**: Содержит `userId` и `role` для scope-контроля на уровне БД-запросов

## Примеры проверок авторизации

```
// Только владелец или админ
if (post.authorId !== req.user.id && req.user.role !== 'admin') {
  return res.status(403).json({ error: 'Forbidden' });
}

// Только админ
if (req.user.role !== 'admin') {
  return res.status(403).json({ error: 'Admin only' });
}
```
