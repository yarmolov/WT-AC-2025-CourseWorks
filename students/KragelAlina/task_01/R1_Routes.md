# Вариант 29 — Кино/сериалы «Что посмотреть?» — Маршруты (user flows)

## 1. Регистрация и аутентификация

**Маршрут**: Новый пользователь

1. Пользователь открывает главную страницу
2. Видит кнопку "Регистрация"
3. Вводит username (мин 3 символа) и password (мин 6 символов)
4. Нажимает "Зарегистрироваться"
5. Система создаёт пользователя с role='user'
6. Перенаправляет на страницу входа или сразу входит

**Маршрут**: Существующий пользователь

1. Пользователь открывает страницу входа
2. Вводит username и password
3. Нажимает "Вход"
4. Система проверяет учётные данные
5. Если корректны → генерирует JWT token
6. Сохраняет token в localStorage
7. Перенаправляет в каталог фильмов

---

## 2. Просмотр каталога (основной экран)

**Маршрут**: Просмотр фильмов с фильтрацией

1. Пользователь попадает на главную страницу `/`
2. Видит список фильмов с постраничной навигацией (по 10 на странице)
3. Может выполнить действия:
   - **Фильтр по названию**: вводит "Inception" → видит только этот фильм
   - **Фильтр по году**: выбирает `year >= 2010` → видит только новые фильмы
   - **Фильтр по жанру**: выбирает "sci-fi" → видит научно-фантастические фильмы
   - **Постраничная навигация**: нажимает "Далее" → переходит на следующую страницу

4. Для каждого фильма видит:
   - Название (name)
   - Тип (movie/series)
   - Жанр (genre)
   - Год выпуска (year)

5. Кликает на фильм → переходит на страницу `/titles/{id}`

---

## 3. Управление списком просмотра

**Маршрут**: Добавить фильм в список

1. Пользователь открывает карточку фильма
2. Видит кнопку "Добавить в список"
3. Выбирает статус из dropdown: `planned` / `watching` / `completed` / `dropped`
4. Нажимает "Добавить"
5. Система отправляет: `POST /lists` с `{title_id, status}`
6. Фильм появляется в личном списке с выбранным статусом

**Маршрут**: Просмотреть свой список просмотра

1. Пользователь открывает личный кабинет / "Мой список"
2. Видит список всех добавленных фильмов
3. Для каждого фильма видит текущий статус
4. Может:
   - **Изменить статус**: выбирает новый из dropdown, система отправляет `POST /lists` с новым статусом
   - **Удалить из списка**: нажимает удалить, система отправляет `DELETE /lists/{id}`

**Маршрут**: Фильтровать свой список по статусу

1. На странице списка пользователь видит фильтр по статусу
2. Выбирает `completed` → видит только завершённые фильмы
3. Выбирает `watching` → видит только фильмы в процессе просмотра

---

## 4. Рецензии

**Маршрут**: Написать рецензию

1. Пользователь открывает карточку фильма
2. Видит форму "Написать рецензию"
3. Вводит текст рецензии (опционально, но рекомендуется)
4. Нажимает "Отправить"
5. Система отправляет: `POST /reviews` с `{title_id, text}`
6. Система проверяет: есть ли уже рецензия этого пользователя на этот фильм?
   - Если да → обновляет существующую рецензию
   - Если нет → создаёт новую
7. Рецензия появляется в списке рецензий этого фильма

**Маршрут**: Просмотреть рецензии

1. На странице фильма пользователь видит список рецензий других пользователей
2. Для каждой рецензии видит:
   - Имя автора
   - Текст рецензии
   - Дату создания
3. Может фильтровать по `title_id` через API: `GET /reviews?title_id=123`

**Маршрут**: Удалить свою рецензию

1. Пользователь видит свою рецензию
2. Нажимает кнопку удаления
3. Система отправляет: `DELETE /reviews/{id}`
4. Проверяет: автор ли это рецензии?
5. Если да → удаляет, если нет → 403 Unauthorized

---

## 5. Оценивание (Rating)

**Маршрут**: Оценить фильм

1. Пользователь открывает карточку фильма
2. Видит форму "Оценить фильм"
3. Выбирает оценку от 1 до 10 (например, слайдер или dropdown)
4. Нажимает "Отправить оценку"
5. Система отправляет: `POST /ratings` с `{title_id, score}`
6. Система проверяет: есть ли уже оценка этого пользователя на этот фильм?
   - Если да → обновляет существующую оценку
   - Если нет → создаёт новую
7. Оценка учитывается в статистике

**Маршрут**: Просмотреть оценки

1. На странице фильма пользователь видит статистику оценок
2. Видит все оценки других пользователей: `GET /ratings?title_id=123`
3. Может видеть распределение оценок (сколько people выбрали 1, 2, ..., 10)

---

## 6. Администратор: управление каталогом

**Маршрут**: Добавить фильм

1. Администратор входит с role='admin'
2. Видит админ-панель
3. Нажимает "Добавить фильм"
4. Вводит: name, type (movie/series), genre, year
5. Нажимает "Создать"
6. Система отправляет: `POST /titles` с `{name, type, genre, year}`
7. Фильм появляется в каталоге для всех пользователей

**Маршрут**: Редактировать фильм

1. Администратор открывает карточку фильма
2. Нажимает "Редактировать"
3. Изменяет поля (название, жанр, год, тип)
4. Нажимает "Сохранить"
5. Система отправляет: `PUT /titles/{id}` с обновлёнными данными

**Маршрут**: Удалить фильм

1. Администратор открывает карточку фильма
2. Нажимает "Удалить"
3. Подтверждает действие
4. Система отправляет: `DELETE /titles/{id}`
5. Фильм удаляется (вместе с его рецензиями, оценками, записями в списках)

**Маршрут**: Загрузить фильмы из TMDB

1. Администратор открывает админ-панель
2. Видит опцию "Загрузить фильмы из TMDB"
3. Выбирает: страницу, кол-во фильмов, сухой прогон (да/нет)
4. Нажимает "Загрузить"
5. Система отправляет: `POST /admin/load_movies` с параметрами
6. Если сухой прогон → показывает список, что будет загружено
7. Если реальная загрузка → добавляет фильмы в БД
