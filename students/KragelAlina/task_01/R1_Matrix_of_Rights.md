# Вариант 29 — Матрица прав (операция × роль)

Роли: **User** (по умолчанию), **Admin**

## Таблица прав (операция × роль)

| Операция | User | Admin | Примечание |
| --------------------------- | ----------- | ------------ | ----------------------- |
| **Каталог фильмов** | | | |
| GET /titles (просмотр с фильтрацией) | ✓ | ✓ | Требует JWT |
| POST /titles (добавить фильм) | ✗ | ✓ | Только админ |
| PUT /titles/{id} (редактировать) | ✗ | ✓ | Только админ |
| DELETE /titles/{id} (удалить) | ✗ | ✓ | Только админ |
| GET /titles/{id} (просмотр детали) | ✓ | ✓ | Требует JWT |
| **Список просмотра** | | | |
| GET /lists (мой список) | ✓ | ✓ | Только свой список |
| POST /lists (добавить фильм) | ✓ | ✓ | В свой список |
| DELETE /lists/{id} (удалить из списка) | ✓* | ✓ | *Только свой, admin любой |
| **Рецензии** | | | |
| GET /reviews (просмотр рецензий) | ✓ | ✓ | Можно фильтровать по title_id |
| POST /reviews (написать рецензию) | ✓ | ✓ | Одна на фильм на пользователя |
| DELETE /reviews/{id} (удалить рецензию) | ✓* | ✓ | *Только своё, admin любой |
| **Оценки** | | | |
| GET /ratings (просмотр оценок) | ✓ | ✓ | Можно фильтровать по title_id |
| POST /ratings (оценить фильм) | ✓ | ✓ | Одна оценка на фильм на пользователя |
| DELETE /ratings/{id} (удалить оценку) | ✓* | ✓ | *Только своё, admin любой |
| **Администрирование** | | | |
| POST /admin/load_movies | ✗ | ✓ | Загрузка фильмов из TMDB |
| GET /apidocs (документация API) | ✓ | ✓ | Доступна для всех |
| **Аутентификация** | | | |
| POST /register | ✗ | ✗ | Не требует JWT, создаёт user |
| POST /login | ✗ | ✗ | Не требует JWT, возвращает token |

## Правила и ограничения

1. **Аутентификация**
   - Все защищённые эндпоинты требуют JWT токен в заголовке `Authorization: Bearer <token>`
   - JWT содержит `user_id` и `role` пользователя

2. **Список просмотра**
   - Пользователь может видеть только свой список: `GET /lists`
   - Пользователь может добавить фильм только в свой список: `POST /lists`
   - Пользователь может удалить только свой элемент списка: `DELETE /lists/{id}`
   - Уникальность: один пользователь не может добавить один фильм более одного раза

3. **Рецензии**
   - Пользователь может написать только одну рецензию на один фильм
   - При повторной попытке система обновляет существующую рецензию
   - Пользователь может удалить только свою рецензию: `DELETE /reviews/{id}`
   - Проверка: `DELETE` возвращает 403 если пользователь не автор

4. **Оценки**
   - Пользователь может поставить только одну оценку на один фильм (1-10)
   - При повторной попытке система обновляет существующую оценку
   - Пользователь может удалить только свою оценку: `DELETE /ratings/{id}`
   - Валидация: оценка должна быть между 1 и 10 (проверяется в Pydantic schema)

5. **Роль админа**
   - Админ может выполнять любые операции (CRUD для всех сущностей)
   - Админ может управлять каталогом фильмов
   - Админ может загружать фильмы из TMDB
   - Админ может удалять любые рецензии и оценки (для модерации)
