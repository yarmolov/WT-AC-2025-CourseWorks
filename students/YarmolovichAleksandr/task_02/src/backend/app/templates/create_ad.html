<!-- htmlhint doctype-first:false -->
{% extends 'base.html' %}
{% block content %}
<div class="row">
  <div class="col-lg-8 offset-lg-2">
    <div style="background: white; padding: 2rem; border-radius: 8px; border: 1px solid #e5e7eb;">
      <h1 style="font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 2rem;">Create New Ad</h1>
      
      <form id="create-ad-form" enctype="multipart/form-data">
        <div class="form-group">
          <label class="form-label">Ad Title *</label>
          <input class="form-control" id="title" required maxlength="120" placeholder="E.g., iPhone 13 Pro, barely used">
        </div>

        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea class="form-control" id="description" rows="5" placeholder="Provide details about your item..."></textarea>
          <small style="color: #9ca3af; margin-top: 0.5rem; display: block;">Be specific about condition, features, and any issues</small>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Category *</label>
              <select id="category-id" class="form-select" required>
                <option value="">Select category</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label class="form-label">Price ($) *</label>
              <input type="number" class="form-control" id="price" min="0" step="0.01" placeholder="0.00" required>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Images</label>
          <div style="border: 2px dashed #d1d5db; border-radius: 6px; padding: 2rem; text-align: center; cursor: pointer;" id="upload-zone">
            <input type="file" class="form-control d-none" id="images" multiple accept="image/*">
            <div style="color: #4b5563; margin-bottom: 0.5rem;">
              <svg style="width: 2rem; height: 2rem; margin-bottom: 0.5rem; color: #9ca3af;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
            </div>
            <p style="margin: 0; font-weight: 500;">Click to upload or drag and drop</p>
            <small style="color: #9ca3af;">PNG, JPG, GIF up to 10MB each</small>
          </div>
          <div id="preview-images" class="media-gallery mt-3"></div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
          <button class="btn btn-primary" style="flex: 1; padding: 0.75rem;" type="submit">Publish Ad</button>
          <a href="/" class="btn btn-secondary" style="flex: 1; padding: 0.75rem; text-align: center;">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const uploadZone = document.getElementById('upload-zone');
  const fileInput = document.getElementById('images');
  const previewDiv = document.getElementById('preview-images');

  uploadZone.addEventListener('click', () => fileInput.click());
  
  uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadZone.style.backgroundColor = '#f3f4f6';
    uploadZone.style.borderColor = '#2563eb';
  });
  
  uploadZone.addEventListener('dragleave', () => {
    uploadZone.style.backgroundColor = 'transparent';
    uploadZone.style.borderColor = '#d1d5db';
  });
  
  uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.style.backgroundColor = 'transparent';
    uploadZone.style.borderColor = '#d1d5db';
    fileInput.files = e.dataTransfer.files;
    updatePreview();
  });
  
  fileInput.addEventListener('change', updatePreview);
  
  function updatePreview() {
    previewDiv.innerHTML = '';
    Array.from(fileInput.files).forEach((file, index) => {
      const reader = new FileReader();
      reader.onload = (e) => {
        const item = document.createElement('div');
        item.className = 'media-item';
        item.innerHTML = `<img src="${e.target.result}" alt="preview"><button type="button" class="media-delete-btn" data-index="${index}">Remove</button>`;
        previewDiv.appendChild(item);
      };
      reader.readAsDataURL(file);
    });
  }
  
  previewDiv.addEventListener('click', (e) => {
    if (e.target.classList.contains('media-delete-btn')) {
      const index = parseInt(e.target.dataset.index);
      const files = Array.from(fileInput.files);
      files.splice(index, 1);
      const dataTransfer = new DataTransfer();
      files.forEach(file => dataTransfer.items.add(file));
      fileInput.files = dataTransfer.files;
      updatePreview();
    }
  });
});
</script>
{% endblock %}